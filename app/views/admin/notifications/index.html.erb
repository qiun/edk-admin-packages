<% content_for :page_title, "Powiadomienia" %>

<div class="mb-6 flex flex-wrap items-center justify-between gap-3">
  <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Powiadomienia</h2>
  
  <% if Notification.for_admins.unread.any? %>
    <%= link_to mark_all_read_admin_notifications_path, 
        method: :post,
        class: "inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700",
        data: { turbo_method: :post } do %>
      <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
      </svg>
      Oznacz wszystkie jako przeczytane
    <% end %>
  <% end %>
</div>

<div class="rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-900">
  <% if @notifications.any? %>
    <div class="divide-y divide-gray-200 dark:divide-gray-800">
      <% @notifications.each do |notification| %>
        <div class="flex items-start gap-4 p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 <%= 'bg-blue-50 dark:bg-blue-900/10' unless notification.read? %>">
          <div class="flex-shrink-0 mt-1">
            <% if notification.notification_type == Notification::OUT_OF_STOCK %>
              <span class="flex h-10 w-10 items-center justify-center rounded-full bg-red-100 text-red-600 dark:bg-red-900/50">
                <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
              </span>
            <% elsif notification.notification_type == Notification::LOW_STOCK %>
              <span class="flex h-10 w-10 items-center justify-center rounded-full bg-amber-100 text-amber-600 dark:bg-amber-900/50">
                <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
              </span>
            <% else %>
              <span class="flex h-10 w-10 items-center justify-center rounded-full bg-blue-100 text-blue-600 dark:bg-blue-900/50">
                <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6z"/>
                </svg>
              </span>
            <% end %>
          </div>
          
          <div class="flex-1 min-w-0">
            <div class="flex items-center gap-2 mb-1">
              <h3 class="text-sm font-semibold text-gray-900 dark:text-white">
                <%= notification.title %>
              </h3>
              <% unless notification.read? %>
                <span class="inline-flex items-center rounded-full bg-blue-100 px-2 py-0.5 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">
                  Nowe
                </span>
              <% end %>
            </div>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">
              <%= notification.message %>
            </p>
            <div class="flex items-center gap-4 text-xs text-gray-400">
              <span><%= l(notification.created_at, format: :long) %></span>
              <% if notification.edition %>
                <span>Edycja: <%= notification.edition.name %></span>
              <% end %>
            </div>
          </div>
          
          <div class="flex-shrink-0">
            <% unless notification.read? %>
              <%= link_to mark_read_admin_notification_path(notification), 
                  method: :post,
                  class: "text-sm text-[#465fff] hover:underline",
                  data: { turbo_method: :post } do %>
                Oznacz jako przeczytane
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
    
    <% if @notifications.respond_to?(:total_pages) && @notifications.total_pages > 1 %>
      <div class="border-t border-gray-200 px-4 py-3 dark:border-gray-800">
        <%= paginate @notifications %>
      </div>
    <% end %>
  <% else %>
    <div class="p-8 text-center">
      <svg class="mx-auto h-12 w-12 text-gray-300 dark:text-gray-600" fill="currentColor" viewBox="0 0 20 20">
        <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"/>
      </svg>
      <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">Brak powiadomień</h3>
      <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Nie masz jeszcze żadnych powiadomień</p>
    </div>
  <% end %>
</div>
