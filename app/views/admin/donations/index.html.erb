<% content_for :title, "Cegiełki publiczne" %>
<% content_for :breadcrumb, "Cegiełki" %>

<div class="space-y-6">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div>
      <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Cegiełki publiczne</h1>
      <p class="text-gray-600 dark:text-gray-400">Zarządzaj wpłatami od darczyńców</p>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
      <div class="flex items-center">
        <div class="p-3 rounded-lg bg-green-100 dark:bg-green-900/30">
          <svg class="h-6 w-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div class="ml-4">
          <p class="text-sm text-gray-500 dark:text-gray-400">Łączna kwota</p>
          <p class="text-2xl font-bold text-gray-900 dark:text-white"><%= number_to_currency(@summary[:total_amount], unit: "zł", format: "%n %u") %></p>
        </div>
      </div>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
      <div class="flex items-center">
        <div class="p-3 rounded-lg bg-blue-100 dark:bg-blue-900/30">
          <svg class="h-6 w-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
          </svg>
        </div>
        <div class="ml-4">
          <p class="text-sm text-gray-500 dark:text-gray-400">Pakiety</p>
          <p class="text-2xl font-bold text-gray-900 dark:text-white"><%= @summary[:total_quantity] %></p>
        </div>
      </div>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
      <div class="flex items-center">
        <div class="p-3 rounded-lg bg-purple-100 dark:bg-purple-900/30">
          <svg class="h-6 w-6 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
          </svg>
        </div>
        <div class="ml-4">
          <p class="text-sm text-gray-500 dark:text-gray-400">Darczyńcy</p>
          <p class="text-2xl font-bold text-gray-900 dark:text-white"><%= @summary[:donation_count] %></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm">
    <div class="flex flex-wrap gap-2">
      <%= link_to "Wszystkie", admin_donations_path,
          class: "px-3 py-1.5 rounded-lg text-sm font-medium transition-colors #{params[:status].blank? ? 'bg-brand-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'}" %>
      <%= link_to "Oczekujące", admin_donations_path(status: :pending),
          class: "px-3 py-1.5 rounded-lg text-sm font-medium transition-colors #{params[:status] == 'pending' ? 'bg-yellow-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'}" %>
      <%= link_to "Opłacone", admin_donations_path(status: :paid),
          class: "px-3 py-1.5 rounded-lg text-sm font-medium transition-colors #{params[:status] == 'paid' ? 'bg-green-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'}" %>
      <%= link_to "Nieudane", admin_donations_path(status: :failed),
          class: "px-3 py-1.5 rounded-lg text-sm font-medium transition-colors #{params[:status] == 'failed' ? 'bg-red-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'}" %>
    </div>
  </div>

  <!-- Donations Table -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
        <thead class="bg-gray-50 dark:bg-gray-700">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">#</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Darczyńca</th>
            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Ilość</th>
            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Kwota</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Status płatności</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Wysyłka</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Data</th>
            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Akcje</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
          <% @donations.each do |donation| %>
            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
              <td class="px-6 py-4 text-sm font-medium text-gray-900 dark:text-white">#<%= donation.id %></td>
              <td class="px-6 py-4">
                <div>
                  <p class="text-sm font-medium text-gray-900 dark:text-white"><%= donation.full_name.presence || "Anonim" %></p>
                  <p class="text-xs text-gray-500 dark:text-gray-400"><%= donation.email %></p>
                </div>
              </td>
              <td class="px-6 py-4 text-center text-sm font-medium text-gray-900 dark:text-white">
                <%= donation.quantity %> szt.
              </td>
              <td class="px-6 py-4 text-right text-sm font-semibold text-gray-900 dark:text-white">
                <%= number_to_currency(donation.amount, unit: "zł", format: "%n %u") %>
              </td>
              <td class="px-6 py-4"><%= status_badge(donation.payment_status) %></td>
              <td class="px-6 py-4">
                <% if donation.shipment.present? %>
                  <%= status_badge(donation.shipment.status) %>
                <% else %>
                  <span class="text-xs text-gray-400 dark:text-gray-500">Brak</span>
                <% end %>
              </td>
              <td class="px-6 py-4 text-sm text-gray-500 dark:text-gray-400">
                <%= donation.created_at.strftime("%d.%m.%Y") %>
              </td>
              <td class="px-6 py-4 text-right text-sm font-medium">
                <div class="flex items-center justify-end gap-1">
                  <%= link_to admin_donation_path(donation), class: "inline-flex p-2 text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-white/5 dark:hover:text-gray-200 rounded-lg transition-colors", title: "Zobacz szczegóły" do %>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                    </svg>
                  <% end %>
                  <% if donation.shipment.present? && donation.shipment.apaczka_order_id.present? && %w[label_printed shipped in_transit delivered].include?(donation.shipment.status) %>
                    <%= link_to download_waybill_admin_shipment_path(donation.shipment), class: "inline-flex p-2 text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-white/5 dark:hover:text-gray-200 rounded-lg transition-colors", title: "Pobierz etykietę" do %>
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"/>
                      </svg>
                    <% end %>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
          <% if @donations.empty? %>
            <tr>
              <td colspan="8" class="px-6 py-12 text-center text-gray-500 dark:text-gray-400">
                Brak cegiełek
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
