<div class="mb-6">
  <div class="flex justify-between items-center mb-4">
    <div>
      <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">
        Przydzielenie pakietów dla rejonu
      </h2>
      <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
        <%= @region.name %> (Edycja: <%= @edition.name %>)
      </p>
    </div>
    <%= link_to "Historia zmian",
                history_leader_region_region_allocation_path(@region),
                class: "inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-center font-medium text-white hover:bg-opacity-90" %>
  </div>

  <%= link_to "← Powrót do rejonu",
              leader_region_path(@region),
              class: "text-primary hover:underline" %>
</div>

<div class="rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark">
  <div class="border-b border-stroke px-6.5 py-4 dark:border-strokedark">
    <h3 class="font-medium text-black dark:text-white">
      Edytuj przydzielenie
    </h3>
  </div>

  <%= form_with model: @allocation,
                url: leader_region_region_allocation_path(@region),
                method: :patch,
                class: "p-6.5" do |f| %>
    <% if @allocation.errors.any? %>
      <div class="mb-4 rounded-lg bg-danger bg-opacity-10 p-4">
        <h3 class="mb-2 font-medium text-danger">
          <%= pluralize(@allocation.errors.count, "błąd", "błędy", "błędów") %> uniemożliwiają zapisanie:
        </h3>
        <ul class="list-disc list-inside text-danger">
          <% @allocation.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="mb-4.5">
      <%= f.label :allocated_quantity, "Przydzielona ilość pakietów",
                  class: "mb-2.5 block text-black dark:text-white" %>
      <%= f.number_field :allocated_quantity,
                         min: 0,
                         class: "w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-3 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary" %>
    </div>

    <div class="mb-4.5">
      <%= f.label :sold_quantity, "Sprzedana ilość pakietów",
                  class: "mb-2.5 block text-black dark:text-white" %>
      <%= f.number_field :sold_quantity,
                         min: 0,
                         class: "w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-3 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary" %>
      <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">
        Pozostało: <%= @allocation.remaining_quantity %> pakietów
      </p>
    </div>

    <!-- Plakaty -->
    <div class="mt-6 pt-4 border-t border-stroke dark:border-strokedark">
      <h4 class="mb-4 text-lg font-medium text-black dark:text-white">Plakaty</h4>

      <div class="mb-4.5">
        <%= f.label :allocated_posters, "Przydzielona ilość plakatów",
                    class: "mb-2.5 block text-black dark:text-white" %>
        <%= f.number_field :allocated_posters,
                           min: 0,
                           value: @allocation.allocated_posters || 0,
                           class: "w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-3 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary" %>
      </div>

      <div class="mb-4.5">
        <%= f.label :distributed_posters, "Wydana ilość plakatów",
                    class: "mb-2.5 block text-black dark:text-white" %>
        <%= f.number_field :distributed_posters,
                           min: 0,
                           value: @allocation.distributed_posters || 0,
                           class: "w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-3 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary" %>
        <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">
          Pozostało: <%= @allocation.remaining_posters %> plakatów
        </p>
      </div>
    </div>

    <div class="mb-6">
      <%= f.label :change_reason, "Powód zmiany (opcjonalnie)",
                  class: "mb-2.5 block text-black dark:text-white" %>
      <%= f.text_area :change_reason,
                      rows: 3,
                      placeholder: "Np. korekta po inwentaryzacji, zwrot od rejonu...",
                      class: "w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-3 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary" %>
    </div>

    <div class="flex gap-3">
      <%= f.submit "Zapisz zmiany",
                   class: "inline-flex items-center justify-center rounded-md bg-primary px-10 py-2 text-center font-medium text-white hover:bg-opacity-90" %>
      <%= link_to "Anuluj",
                  leader_region_path(@region),
                  class: "inline-flex items-center justify-center rounded-md border border-primary px-10 py-2 text-center font-medium text-primary hover:bg-opacity-90" %>
    </div>
  <% end %>
</div>

<% if @allocation.persisted? %>
  <div class="mt-6 rounded-sm border border-stroke bg-white p-6.5 shadow-default dark:border-strokedark dark:bg-boxdark">
    <h3 class="mb-4 font-medium text-black dark:text-white">Statystyki</h3>

    <!-- Pakiety -->
    <h4 class="mb-2 text-sm font-medium text-gray-600 dark:text-gray-400">Pakiety</h4>
    <div class="grid grid-cols-1 gap-4 md:grid-cols-3 mb-6">
      <div>
        <p class="text-sm text-gray-600 dark:text-gray-400">Przydzielone</p>
        <p class="text-2xl font-bold text-black dark:text-white">
          <%= @allocation.allocated_quantity %>
        </p>
      </div>
      <div>
        <p class="text-sm text-gray-600 dark:text-gray-400">Sprzedane</p>
        <p class="text-2xl font-bold text-black dark:text-white">
          <%= @allocation.sold_quantity %>
        </p>
      </div>
      <div>
        <p class="text-sm text-gray-600 dark:text-gray-400">Pozostało</p>
        <p class="text-2xl font-bold text-black dark:text-white">
          <%= @allocation.remaining_quantity %>
        </p>
      </div>
    </div>

    <!-- Plakaty -->
    <% if @allocation.has_posters? %>
      <h4 class="mb-2 text-sm font-medium text-gray-600 dark:text-gray-400">Plakaty</h4>
      <div class="grid grid-cols-1 gap-4 md:grid-cols-3">
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400">Przydzielone</p>
          <p class="text-2xl font-bold text-black dark:text-white">
            <%= @allocation.allocated_posters %>
          </p>
        </div>
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400">Wydane</p>
          <p class="text-2xl font-bold text-black dark:text-white">
            <%= @allocation.distributed_posters %>
          </p>
        </div>
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400">Pozostało</p>
          <p class="text-2xl font-bold text-black dark:text-white">
            <%= @allocation.remaining_posters %>
          </p>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
